{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/TisoneK/agentfile/schema/workflow.schema.json",
  "title": "Agentfile Workflow",
  "description": "Schema for Agentfile workflow.yaml configuration files.",
  "type": "object",
  "required": [
    "name",
    "version",
    "description",
    "trigger",
    "steps",
    "specVersion"
  ],
  "additionalProperties": false,
  "properties": {
    "name": {
      "type": "string",
      "description": "Workflow identifier. Lowercase, hyphenated.",
      "pattern": "^[a-z][a-z0-9-]*$",
      "examples": [
        "code-reviewer",
        "pr-summarizer",
        "doc-generator"
      ]
    },
    "version": {
      "type": "string",
      "description": "Semantic version of this workflow.",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "examples": [
        "1.0.0",
        "2.1.0"
      ]
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of what this workflow does."
    },
    "trigger": {
      "type": "object",
      "description": "Defines how and when this workflow is started.",
      "required": [
        "type"
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "description": "The trigger mechanism.",
          "enum": [
            "natural-language",
            "file",
            "schedule",
            "command"
          ]
        },
        "input_var": {
          "type": "string",
          "description": "Environment variable name that holds the trigger input.",
          "examples": [
            "AGENT_INPUT",
            "WORKFLOW_REQUEST"
          ]
        }
      }
    },
    "output": {
      "type": "object",
      "description": "Where the workflow's final output is written.",
      "additionalProperties": false,
      "properties": {
        "directory": {
          "type": "string",
          "description": "Target directory for the final output.",
          "examples": [
            "workflows/{workflow_name}",
            "outputs/"
          ]
        }
      }
    },
    "steps": {
      "type": "array",
      "description": "Ordered list of steps to execute.",
      "minItems": 1,
      "items": {
        "oneOf": [
          {
            "$ref": "#/definitions/agentStep"
          },
          {
            "$ref": "#/definitions/shellStep"
          }
        ]
      }
    },
    "specVersion": {
      "type": "string",
      "description": "Agentfile spec version this workflow targets.",
      "enum": [
        "1.0"
      ],
      "examples": [
        "1.0"
      ]
    }
  },
  "definitions": {
    "agentStep": {
      "type": "object",
      "title": "Agent Step",
      "description": "A step that calls an LLM agent.",
      "required": [
        "id",
        "name",
        "agent",
        "input",
        "goal",
        "produces"
      ],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique step identifier. Lowercase, hyphenated.",
          "pattern": "^[a-z][a-z0-9-]*$"
        },
        "name": {
          "type": "string",
          "description": "Human-readable step name."
        },
        "agent": {
          "type": "string",
          "description": "Relative path to the agent .md file.",
          "examples": [
            "agents/reviewer.md",
            "agents/analyst.md"
          ]
        },
        "skill": {
          "type": "string",
          "description": "Relative path to a skill .md file to inject into the user prompt.",
          "examples": [
            "skills/code-analysis.md",
            "skills/write-review.md"
          ]
        },
        "input": {
          "type": "string",
          "description": "Input to the step. A file path or $VAR reference.",
          "examples": [
            "$AGENT_INPUT",
            "outputs/analysis.md"
          ]
        },
        "goal": {
          "type": "string",
          "description": "What this step is trying to achieve."
        },
        "produces": {
          "type": "string",
          "description": "Path to the artifact this step writes.",
          "examples": [
            "outputs/analysis.md",
            "outputs/review.md"
          ]
        },
        "gate": {
          "type": "string",
          "description": "If set to human-approval, pause for user confirmation before continuing.",
          "enum": [
            "human-approval"
          ]
        }
      }
    },
    "shellStep": {
      "type": "object",
      "title": "Shell Step",
      "description": "A step that runs a shell script directly.",
      "required": [
        "id",
        "name",
        "action",
        "script",
        "goal"
      ],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique step identifier. Lowercase, hyphenated.",
          "pattern": "^[a-z][a-z0-9-]*$"
        },
        "name": {
          "type": "string",
          "description": "Human-readable step name."
        },
        "action": {
          "type": "string",
          "description": "Must be 'shell' for shell steps.",
          "enum": [
            "shell"
          ]
        },
        "script": {
          "type": "object",
          "description": "Paths to the scripts to execute.",
          "additionalProperties": false,
          "properties": {
            "bash": {
              "type": "string",
              "description": "Path to the Bash script.",
              "examples": [
                "scripts/register.sh"
              ]
            },
            "pwsh": {
              "type": "string",
              "description": "Path to the PowerShell script.",
              "examples": [
                "scripts/register.ps1"
              ]
            }
          }
        },
        "goal": {
          "type": "string",
          "description": "What this step does."
        }
      }
    }
  }
}