# Skill: Vulnerability Detection

## Purpose
Scan source code for security vulnerabilities, weaknesses, and compliance gaps using established security frameworks and threat models.

## Instructions

1. **Apply Security Rules Engine**
   - Scan for OWASP Top 10 vulnerability patterns
   - Check for CWE (Common Weakness Enumeration) issues
   - Apply language-specific security rules
   - Identify injection flaws and input validation issues

2. **Analyze Data Flow**
   - Trace user input through application logic
   - Identify data sanitization and validation points
   - Check for sensitive data exposure risks
   - Assess authentication and authorization flows

3. **Dependency Security Analysis**
   - Scan third-party dependencies for known vulnerabilities
   - Check against CVE (Common Vulnerabilities and Exposures) database
   - Assess dependency freshness and maintenance status
   - Identify transitive dependency risks

4. **Cryptographic Assessment**
   - Evaluate encryption implementation and key management
   - Check for weak cryptographic algorithms
   - Assess random number generation quality
   - Verify secure storage of sensitive data

5. **Access Control Review**
   - Analyze authentication mechanisms and session management
   - Check authorization logic and privilege escalation risks
   - Assess API security and rate limiting
   - Review logging and monitoring for security events

6. **Generate Security Report**
   - Categorize findings by CVSS severity scores
   - Provide attack scenario analysis for each vulnerability
   - Include specific remediation steps and code examples
   - Assess overall security posture and compliance level

## Examples

### SQL Injection Detection
```python
# Vulnerable: Direct string concatenation
def get_user(user_id):
    query = "SELECT * FROM users WHERE id = " + user_id
    return db.execute(query)

# Secure: Parameterized queries
def get_user(user_id):
    query = "SELECT * FROM users WHERE id = ?"
    return db.execute(query, (user_id,))
```

### XSS Prevention
```javascript
// Vulnerable: Direct HTML insertion
element.innerHTML = userInput;

// Secure: Text content or sanitization
element.textContent = userInput;
// or
element.innerHTML = DOMPurify.sanitize(userInput);
```

### Vulnerability Classification
```markdown
## Critical Vulnerabilities
### SQL Injection (CWE-89)
**CVSS Score:** 9.8 (Critical)
**File:** src/auth.py
**Lines:** 23-25
**Attack Vector:** Network
**Description:** User input directly concatenated into SQL query
**Impact:** Complete database compromise possible
**Remediation:** Use parameterized queries or ORM

### Hard-coded Credentials (CWE-798)
**CVSS Score:** 7.5 (High)
**File:** config/database.py
**Lines:** 12
**Description:** Database password stored in source code
**Impact:** Unauthorized database access
**Remediation:** Use environment variables or secret management
```

### Dependency Vulnerability Report
```markdown
## Dependency Security
### lodash < 4.17.21
**CVE:** CVE-2021-23337
**Severity:** High
**Vulnerability:** Prototype pollution
**Recommendation:** Upgrade to lodash >= 4.17.21
### express < 4.17.0
**CVE:** CVE-2019-16758
**Severity:** Medium
**Vulnerability:** Denial of service
**Recommendation:** Upgrade to express >= 4.17.0
```

### Bad Example to Avoid
```markdown
# Non-specific, unactionable security advice
## Security Issues
- Some security problems found
- Need to fix vulnerabilities
- Update dependencies
```

## Validation Checklist
- [ ] All major vulnerability categories covered
- [ ] CVSS scores calculated and justified
- [ ] Specific remediation steps provided
- [ ] Attack scenarios explained clearly
- [ ] Dependency analysis completed
- [ ] Cryptographic implementation reviewed
- [ ] Access control mechanisms assessed
- [ ] Compliance frameworks referenced (OWASP, CWE, NIST)
